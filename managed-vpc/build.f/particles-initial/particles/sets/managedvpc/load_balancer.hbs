{{!-- Load Balancers --}}

{{parameter "load_balancer/security_groups" logicalId="SecurityGroups"}}
{{parameter "load_balancer/subnets" logicalId="Subnets"}}
{{parameter "load_balancer/instance_list" logicalId="Instances"}}
{{parameter "load_balancer/listener/port_number" logicalId="LoadBalancerPort" description="Specify the external load balancer port number"}}
{{parameter "load_balancer/listener/port_number" logicalId="InstancePort" description="Specify the TCP port on which the instance server listens"}}
{{parameter "load_balancer/listener/protocol" logicalId="Protocol" description="Specify the load balancer transport protocol to use for routing"}}
{{parameter "load_balancer/listener/protocol" logicalId="InstanceProtocol" description="Specify the instance transport protocol to use for routing"}}
{{parameter "load_balancer/listener/sslcertid" logicalId="SSLCertificateId"}}
{{parameter "name_tag" logicalId="NameTag"}}
{{parameter "target" logicalId="Target" description="Specifies the instance's protocol and port to check"}}
{{parameter "load_balancer/accessloggingpolicy/emitinterval" logicalId="EmitInterval"}}
{{parameter "load_balancer/accessloggingpolicy/enabled" logicalId="Enabled"}}
{{parameter "load_balancer/accessloggingpolicy/s3bucketname" logicalId="S3BucketName"}}
{{parameter "load_balancer/accessloggingpolicy/s3bucketprefix" logicalId="S3BucketPrefix"}}

{{#resource "load_balancer" logicalId="ManagedELB01"
  nameTag=(ref "NameTag")
  securityGroups=(ref "SecurityGroups")
  subnets=(ref "Subnets")
  instances=(ref "Instances")
  loadbalancerport=(ref "LoadBalancerPort")
  instanceport=(ref "InstancePort")
  instanceprotocol=(ref "InstanceProtocol")
  protocol=(ref "Protocol")
  sslcertificateid=(ref "SSLCertificateId")
  target=(ref Target)
  emitinterval=(ref EmitInterval)
  enabled=(ref Enabled)
  s3bucketname=(ref S3BucketName)
  s3bucketprefix=(ref S3BucketPrefix)

}}
"Properties": {
  {{#if nameTag}}"Tags": [{"Key": "Name", "Value": {{helper "m:core" "propertyValue" nameTag}} }]{{/if}}
}
{{/resource}}

{{#output 'load_balancer' logicalId=(concat "ManagedELB01" 'Id')}}
  "Value": {"Ref": "ManagedELB01"}
{{/output}}
